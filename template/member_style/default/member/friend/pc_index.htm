{extend name="$member_style_layout" /}

{block name="content"}
  <link rel="stylesheet" href="__STATIC__/layui/css/layui.css?d" media="all">
  <link rel="stylesheet" href="__STATIC__/layui/css/admin.css?g" media="all">
  <link rel="stylesheet" href="__STATIC__/layui/css/template.css?g" media="all">
 <style type="text/css">
html #layuicss-layuiAdmin{display:none;position:absolute;width:1989px}::-webkit-input-placeholder{color:#ccc}html{background-color:#f2f2f2;color:#666}.layadmin-tabsbody-item,[template]{display:none}[lay-href],[lay-tips],[layadmin-event]{cursor:pointer}.layui-layout-admin .layui-header{position:fixed;top:0;left:0;width:100%;height:50px}.layui-layout-admin .layui-header .layui-nav .layui-nav-child a{color:#333}.layui-layout-admin .layui-side{width:220px;top:0;z-index:1001}.layui-layout-admin .layui-header .layui-nav .layui-nav-item,.layui-layout-admin .layui-logo{height:50px;line-height:50px}.layui-layout-admin .layui-logo{position:fixed;left:0;top:0;z-index:1002;width:220px;height:49px;padding:0 15px;box-sizing:border-box;overflow:hidden;font-weight:300;background-repeat:no-repeat;background-position:center center}.layadmin-pagetabs,.layui-layout-admin .layui-body,.layui-layout-admin .layui-footer,.layui-layout-admin .layui-layout-left{left:220px}.layadmin-pagetabs{position:fixed;top:50px;right:0;z-index:999}.layadmin-pagetabs .layui-breadcrumb{padding:0 15px}.layui-layout-admin .layui-body{position:fixed;top:90px;bottom:0}.layui-layout-admin .layui-body .layadmin-tabsbody-item{position:absolute;top:0;bottom:0;left:0;right:0;overflow:hidden}.layui-layout-admin .layui-header .layui-nav-img{width:26px;height:26px}.layui-layout-admin .layui-header .layui-nav-child{top:55px}.layui-layout-admin .layui-header .layui-layout-right .layui-nav-child{left:auto;right:0}.layui-layout-admin .layui-header .layui-nav .layui-nav-child dd.layui-this,.layui-layout-admin .layui-header .layui-nav .layui-nav-child dd.layui-this a{background:0 0}.layadmin-pagetabs,.layui-layout-admin .layui-body,.layui-layout-admin .layui-footer,.layui-layout-admin .layui-header .layui-layout-right,.layui-layout-admin .layui-header .layui-nav .layui-nav-item,.layui-layout-admin .layui-layout-left,.layui-layout-admin .layui-logo,.layui-layout-admin .layui-side{transition:all .3s;-webkit-transition:all .3s}.layui-icon-login-qq{color:#3492ED}.layui-icon-login-wechat{color:#4DAF29}.layui-icon-login-weibo{color:#CF1900}.layui-form[wid100] .layui-form-label{width:100px}.layui-form[wid100] .layui-input-block{margin-left:130px}@media screen and (max-width:450px){.layui-form[wid100] .layui-form-item .layui-input-inline{margin-left:132px}.layui-form[wid100] .layui-form-item .layui-input-inline+.layui-form-mid{margin-left:130px}}.layui-form-item .layui-input-company{width:auto;padding-right:10px;line-height:38px}.layui-bg-white{background-color:#fff}.layadmin-loading{position:absolute;left:50%;top:50%;margin:-16px -15px;font-size:30px;color:#c2c2c2}.layadmin-fixed{position:fixed;left:0;top:0;z-index:999}.layadmin-link{color:#029789!important}.layadmin-link:hover{opacity:.8}.layui-layer-admin .layui-layer-title{height:50px;line-height:50px;border:0;background-color:#20222A;color:#fff}.layui-layer-admin i[close]{position:absolute;padding:5px;right:10px;top:12px;color:#fff;cursor:pointer}.layui-layer-admin .layui-layer-content{padding:20px;line-height:22px}.layui-layer-admin .layui-layer-content cite{font-style:normal;color:#FF5722}.layui-layer-adminRight{top:50px!important;bottom:0;box-shadow:1px 1px 10px rgba(0,0,0,.1);border-radius:0;overflow:auto}.layadmin-note .layui-layer-content{padding:0}.layadmin-note textarea{display:block;width:300px;height:132px;min-width:300px;min-height:132px;line-height:20px;padding:10px 20px;border:none;box-sizing:border-box;color:#666;word-wrap:break-word}

.caller-iconset a{
	background:#eee;
	padding:4px 8px;
	margin-left:8px;
}
 </style>

<style type="text/css">
.setuser{
	font-size:16px;
	background:#fff;
	color:rgb(15, 166, 216);
	padding:3px 8px 5px 8px;
	border-radius:3px;
	margin:5px 0 15px 0;
	display:block;
}	
</style>
<script type="text/javascript">
function search_order(){
	$.get(baseurl + "&union=aid,type,by,order,name&aid={$id}&name="+ $("#nick_name").val() +'&'+Math.random(),function(res){
		if(res.code==0){
			if(res.data==''){
				layer.msg("很抱歉！没找到",{time:1000});
				$('.caller-contar').eq(choose_i).html('');
			}else{
				$('.caller-contar').eq(choose_i).html(res.data);
			}
		}else{
			layer.msg(res.msg,{time:2500});
		}
	});
}
</script>
  <div class="layui-fluid">
    <div class="layadmin-caller"> <!--
      <form class="layui-form caller-seach" action="">
	  <div style="float:left;width:80%;">
              <i class="layui-icon layui-icon-search caller-seach-icon caller-icon"></i>
              <input type="text" name="title" id="nick_name" required  lay-verify="required" placeholder="请输入用户名" autocomplete="off" class="layui-input caller-pl32">
       </div>
		<button type="button" style="float:right;margin-right:10px; " onclick="search_order()" class="layui-btn">搜索</button>
      </form> -->
      <div class="layui-tab layui-tab-brief caller-tab" lay-filter="docDemoTabBrief">
        <ul class="layui-tab-title">
          <li class="layui-this">我的好友</li> 
		  <li>我关注的</li> 
		  <li>我的粉丝</li>
		  <li>黑名单</li>
        </ul>
      </div>
      <div class="caller-contar">
	  {php}unset($suid);$type=2;{/php}
        {qb:tag name="myfriend_pclist001" class="app\common\model\Friend@get_label" where="suid=$suid&type=$type&uid=$userdb.uid" rows="10"}
        <div class="caller-item listmember-{$rs.id}">
          <a href="{:get_url('user',$rs.he_id)}" target="blank"><img src="{$rs.he_id|get_user_icon}" onerror="this.src='__STATIC__/images/nopic.png'" class="caller-img caller-fl"></a>
          <div class="caller-main caller-fl">       
            <p><a href="{:get_url('user',$rs.he_id)}" target="blank"><strong>{$rs.he_id|get_user_name}</strong><i> </i></a> 　<em><i class="si si-flag"></i> 最近访问：{$rs.update_time|format_time=true} 　<i class="si si-clock"></i> 建立时间：{$rs.create_time}</em></p>
            <div class="caller-iconset">
			   <a href="javascript:" onclick="act('del','{$rs.he_id}','{$rs.id}')"><i class="fa fa-times"> 移除</i></a>
			   {if $rs.type!=2}<a href="javascript:" onclick="act('add','{$rs.he_id}')"><i class="si si-user-follow"> 加好友</i></a>{/if}
			   {if ($rs.type!=-1&&$rs.suid!=$userdb.uid) || fun('friend@my',$rs.uid)['type']!=-1}<a href="javascript:" onclick="act('bad','{$rs.he_id}')"><i class="si si-ban"> 拉黑</i></a>{/if}
               <a href="{:murl('member/msg/add',['uid'=>$rs.he_id])}" class="_pop"><i class="fa fa-comment-o"></i>私信Ta</a>
            </div>
          </div>		 
        </div>
		{/qb:tag}
      </div>
	  <div class="caller-contar"></div>
	  <div class="caller-contar"></div>
	  <div class="caller-contar"></div>
    </div>
</div>

<script type="text/javascript">
var ajax_url_db = ['type=2&uid={$userdb.uid}','type=1&uid={$userdb.uid}','type=1&suid={$userdb.uid}&uid=','type=-1&uid={$userdb.uid}'];
var choose_i = 0; //当前选中第几项
var haveshowpage = []; //每一项,作个标志,已经已显示到第几页
	//haveshowpage[0] = 1;	//第一项是从第二页开始,第一页显示过了
var show_total = [];

var baseurl = '{qb:url name="myfriend_pclist001"/}';

//显示更多
function showMoreContent(){
	haveshowpage[choose_i]++;
	$.get(baseurl + haveshowpage[choose_i] + '&' + ajax_url_db[choose_i] + '&' + Math.random(),function(res){
		if(res.code==0){
			if(res.data==''){
				layer.msg("已经显示完了！",{time:500});
				if(haveshowpage[choose_i]==1){
					$('.caller-contar').eq(choose_i).html('');
				}
			}else{
				if(haveshowpage[choose_i]==1){
					$('.caller-contar').eq(choose_i).html(res.data);
				}else{
					$('.caller-contar').eq(choose_i).append(res.data);
				}
				if(typeof(show_total[choose_i])=='undefined'){
					$('.layui-tab-title li').eq(choose_i).html($('.layui-tab-title li').eq(choose_i).html()+'('+res.paginate.total+')');
				}				
				show_total[choose_i] = res.paginate.total;
				scroll_get = true;
			}
		}else{
			layer.msg(res.msg,{time:2500});
		}
	});
}

//切换显示
function showContentType(num){	
	//更多显示
	choose_i = num;
	if( haveshowpage[num] == undefined ){
		 haveshowpage[num] = 0;
		 showMoreContent();
	}
	//切换显示
	$('.layui-tab-title li').removeClass('layui-this');
	$('.layui-tab-title li').eq(num).addClass('layui-this');
	$('.caller-contar').hide();
	$('.caller-contar').eq(num).show();
}

//切换按钮添加事件
$('.layui-tab-title li').click(function(){
	var thisnum=$(this).index();
	showContentType(thisnum);
});

//初始化点中第一项
showContentType(0);

function act(type,uid,id){
	$.get('{:murl("wxapp.friend/act")}?type='+type+'&uid='+uid,function(res){		
		if(res.code==0){
			if(type=='del'){
				layer.msg("移除成功",{time:500});
				$(".listmember-"+id).hide();
			}else{
				layer.msg("操作成功" ,{time:500});
				window.location.reload();
			}			
		}else{
			layer.alert(res.msg ,{time:2500});
		}
	});
}


//滚动显示更多
var scroll_get = true;	//做个标志,不要反反复复的加载
$(document).ready(function () {
	$(window).scroll(function () {
		if (scroll_get==true &&  (400 + $(window).scrollTop())>($(document).height() - $(window).height())) {
			scroll_get = false;			
			layer.msg('内容加截中,请稍候',{time:1500});
			showMoreContent();
		}
	});
});
</script>

{/block}